<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Environment.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">qulice-checkstyle</a> &gt; <a href="../index.html" class="el_bundle">qulice-spi</a> &gt; <a href="index.source.html" class="el_package">com.qulice.spi</a> &gt; <span class="el_source">Environment.java</span></div><h1>Environment.java</h1><pre class="source lang-java linenums">/*
 * SPDX-FileCopyrightText: Copyright (c) 2011-2025 Yegor Bugayenko
 * SPDX-License-Identifier: MIT
 */
package com.qulice.spi;

import java.io.File;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.Map;
import java.util.Set;
import org.apache.commons.io.FileUtils;
import org.apache.commons.io.filefilter.DirectoryFileFilter;
import org.apache.commons.io.filefilter.IOFileFilter;
import org.apache.commons.io.filefilter.WildcardFileFilter;

/**
 * Environment.
 *
 * @since 0.3
 */
@SuppressWarnings(&quot;PMD.TooManyMethods&quot;)
public interface Environment {

    /**
     * Get project's basedir.
     * @return The directory
     */
    File basedir();

    /**
     * Get directory to keep temporary files in.
     * @return The directory
     */
    File tempdir();

    /**
     * Get directory where &lt;tt&gt;.class&lt;/tt&gt; files are stored.
     * @return The directory
     */
    File outdir();

    /**
     * Get parameter by name, and return default if it's not set.
     * @param name The name of parameter
     * @param value Default value to return as default
     * @return The value
     */
    String param(String name, String value);

    /**
     * Get classloader for this project.
     * @return The classloader
     */
    ClassLoader classloader();

    /**
     * Get list of paths in classpath.
     * @return The collection of paths
     */
    Collection&lt;String&gt; classpath();

    /**
     * Returns the files matching the specified pattern.
     *
     * &lt;p&gt;The pattern matching scheme used is wildcard matching. The characters
     * '?' and '*' represents single or multiple wildcard characters,
     * respectively. Pattern matching is case sensitive.
     *
     * @param pattern File name pattern.
     * @return Collection of files, matching the specified pattern.
     */
    Collection&lt;File&gt; files(String pattern);

    /**
     * Shall this item be excluded from report?
     * @param check Name of the check that is asking
     * @param name File or any other item, which is subject of validation
     * @return TRUE if it should be ignored
     */
    boolean exclude(String check, String name);

    /**
     * List of exclude patterns for given checker.
     * Each list element will contain exactly one exclude pattern which,
     * depending on the plugin that uses the excludes might be either wildcard
     * (CodeNarc) pattern or regex pattern (FindBugs).
     * @param checker Name of the checker that is asking (pmd, codenarc ...)
     * @return Exclude patterns
     */
    Collection&lt;String&gt; excludes(String checker);

    /**
     * Encoding for the files.
     * @return Source files charset
     */
    Charset encoding();

    /**
     * Mock of {@link Environment}.
     *
     * @since 0.1
     */
<span class="nc" id="L111">    final class Mock implements Environment {</span>
        /**
         * The basedir.
         */
        private final File basedir;

        /**
         * Files for classpath.
         */
        private final Set&lt;String&gt; classpath;

        /**
         * Map of params.
         */
        private final Map&lt;String, String&gt; params;

        /**
         * Exclude patterns.
         */
        private String excl;

        /**
         * Public ctor.
         * @throws IOException If some IO problem
         */
        @SuppressWarnings(
            &quot;PMD.ConstructorOnlyInitializesOrCallOtherConstructors&quot;
            )
<span class="nc" id="L139">        public Mock() throws IOException {</span>
<span class="nc" id="L140">            this.params = new HashMap&lt;&gt;();</span>
<span class="nc" id="L141">            this.classpath = new HashSet&lt;&gt;(1);</span>
<span class="nc" id="L142">            final File temp = File.createTempFile(</span>
                &quot;mock&quot;, &quot;.qulice&quot;,
<span class="nc" id="L144">                new File(System.getProperty(&quot;java.io.tmpdir&quot;))</span>
            );
<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (!temp.delete()) {</span>
<span class="nc" id="L147">                throw new IllegalStateException(&quot;files collision&quot;);</span>
            }
<span class="nc bnc" id="L149" title="All 2 branches missed.">            if (!temp.mkdirs()) {</span>
<span class="nc" id="L150">                throw new IllegalStateException(&quot;mkdir failed&quot;);</span>
            }
<span class="nc" id="L152">            FileUtils.forceDeleteOnExit(temp);</span>
<span class="nc" id="L153">            this.basedir = new File(temp, &quot;basedir&quot;);</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if (this.basedir.mkdirs()) {</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">                assert this.basedir != null;</span>
            }
<span class="nc" id="L157">            this.classpath.add(</span>
<span class="nc" id="L158">                this.outdir().getAbsolutePath().replace(File.separatorChar, '/')</span>
            );
<span class="nc" id="L160">        }</span>

        /**
         * With this param and its value.
         * @param name Param name
         * @param value Param value
         * @return This object
         */
        public Environment.Mock withParam(final String name,
            final String value) {
<span class="nc" id="L170">            this.params.put(name, value);</span>
<span class="nc" id="L171">            return this;</span>
        }

        /**
         * With this file on board.
         * @param name File name related to basedir
         * @param content File content to write
         * @return This object
         * @throws IOException If some IO problem
         */
        public Environment.Mock withFile(final String name,
            final String content) throws IOException {
<span class="nc" id="L183">            final File file = new File(this.basedir, name);</span>
<span class="nc" id="L184">            FileUtils.writeStringToFile(</span>
                file,
                content,
                StandardCharsets.UTF_8
            );
<span class="nc" id="L189">            return this;</span>
        }

        /**
         * With this file on board.
         * @param name File name related to basedir
         * @param bytes File content to write
         * @return This object
         * @throws IOException If some IO problem
         */
        public Environment.Mock withFile(final String name,
            final byte[] bytes) throws IOException {
<span class="nc" id="L201">            final File file = new File(this.basedir, name);</span>
<span class="nc" id="L202">            FileUtils.writeByteArrayToFile(file, bytes);</span>
<span class="nc" id="L203">            return this;</span>
        }

        /**
         * With exclude patterns.
         * @param excludes Exclude patterns
         * @return This object
         */
        public Environment.Mock withExcludes(final String excludes) {
<span class="nc" id="L212">            this.excl = excludes;</span>
<span class="nc" id="L213">            return this;</span>
        }

        /**
         * With default classpath.
         * @return This object
         */
        @SuppressWarnings(&quot;PMD.AvoidInstantiatingObjectsInLoops&quot;)
        public Environment.Mock withDefaultClasspath() {
<span class="nc" id="L222">            Collections.addAll(</span>
                this.classpath,
<span class="nc" id="L224">                System.getProperty(&quot;java.class.path&quot;)</span>
<span class="nc" id="L225">                    .split(System.getProperty(&quot;path.separator&quot;))</span>
            );
<span class="nc" id="L227">            return this;</span>
        }

        @Override
        public File basedir() {
<span class="nc" id="L232">            return this.basedir;</span>
        }

        @Override
        public File tempdir() {
<span class="nc" id="L237">            final File file = new File(this.basedir, &quot;target/tempdir&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">            if (file.mkdirs()) {</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">                assert file != null;</span>
            }
<span class="nc" id="L241">            return file;</span>
        }

        @Override
        public File outdir() {
<span class="nc" id="L246">            final File file = new File(this.basedir, &quot;target/classes&quot;);</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">            if (file.mkdirs()) {</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">                assert file != null;</span>
            }
<span class="nc" id="L250">            return file;</span>
        }

        @Override
        public String param(final String name, final String value) {
<span class="nc" id="L255">            String val = this.params.get(name);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">            if (val == null) {</span>
<span class="nc" id="L257">                val = value;</span>
            }
<span class="nc" id="L259">            return val;</span>
        }

        @Override
        public ClassLoader classloader() {
<span class="nc" id="L264">            return Thread.currentThread().getContextClassLoader();</span>
        }

        @Override
        public Collection&lt;String&gt; classpath() {
<span class="nc" id="L269">            return Collections.unmodifiableCollection(this.classpath);</span>
        }

        @Override
        @SuppressWarnings(&quot;PMD.AvoidInstantiatingObjectsInLoops&quot;)
        public Collection&lt;File&gt; files(final String pattern) {
<span class="nc" id="L275">            final Collection&lt;File&gt; files = new LinkedList&lt;&gt;();</span>
<span class="nc" id="L276">            final IOFileFilter filter = WildcardFileFilter.builder().setWildcards(pattern).get();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">            if (this.basedir().exists()) {</span>
<span class="nc" id="L278">                files.addAll(</span>
<span class="nc" id="L279">                    FileUtils.listFiles(</span>
<span class="nc" id="L280">                        this.basedir(),</span>
                        filter,
                        DirectoryFileFilter.INSTANCE
                    )
                );
            }
<span class="nc" id="L286">            return files;</span>
        }

        @Override
        public boolean exclude(final String check, final String name) {
<span class="nc" id="L291">            return false;</span>
        }

        @Override
        public Collection&lt;String&gt; excludes(final String checker) {
            final Collection&lt;String&gt; exc;
<span class="nc bnc" id="L297" title="All 2 branches missed.">            if (this.excl == null) {</span>
<span class="nc" id="L298">                exc = Collections.emptyList();</span>
            } else {
<span class="nc" id="L300">                exc = Arrays.asList(this.excl.split(&quot;,&quot;));</span>
            }
<span class="nc" id="L302">            return exc;</span>
        }

        @Override
        public Charset encoding() {
<span class="nc" id="L307">            return StandardCharsets.UTF_8;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>